(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const s=(t,e=document)=>e.querySelector(t),v=(t,e=document)=>Array.from(e.querySelectorAll(t)),E=document.getElementById("nav-toggle"),C=document.getElementById("menu-close"),b=document.getElementById("mobile-menu");E?.addEventListener("click",()=>{b.style.display="flex"});C?.addEventListener("click",()=>{b.style.display="none"});document.addEventListener("DOMContentLoaded",()=>{const t=s("#search-btn"),e=s("#mobile-popup"),o=s("#popup-close"),r=s("#popup-clear");t&&e&&o&&(t.addEventListener("click",n=>{window.innerWidth<=768&&(n.preventDefault(),e.classList.add("active"),e.setAttribute("aria-hidden","false"),document.body.classList.add("popup-open"))}),o.addEventListener("click",()=>{e.classList.remove("active"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("popup-open")}),r?.addEventListener("click",()=>{e.querySelectorAll("input").forEach(n=>n.value=""),e.querySelectorAll(".accueil__num").forEach(n=>n.textContent="0")}))});document.addEventListener("DOMContentLoaded",()=>{const t=s(".features-toggle"),e=v(".feature__accueil2.feature-hidden");t&&t.addEventListener("click",()=>{const o=t.classList.toggle("open"),r=t.querySelector("i");r.classList.toggle("fa-chevron-down",!o),r.classList.toggle("fa-chevron-up",o),t.setAttribute("aria-expanded",o?"true":"false"),e.forEach(n=>n.style.display=o?"flex":"none")})});const f=6;let u=[],l=[],p=1,a,d;function x(){if(s("#map")){if(typeof L>"u"){console.error("❌ Leaflet non chargé.");return}a=L.map("map",{zoomControl:!0}).setView([46.5,2],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(a),d=L.layerGroup().addTo(a),setTimeout(()=>a.invalidateSize(),300),console.log("✅ Carte Leaflet catalogue initialisée !")}}function w(){if(!a||!d)return;d.clearLayers();const t=l.filter(o=>o.style.display!=="none"),e=[];t.forEach(o=>{const r=parseFloat(o.dataset.lat),n=parseFloat(o.dataset.lng);if(isNaN(r)||isNaN(n))return;const i=o.dataset.prix||"",c=o.dataset.ville||"",g=o.dataset.dispo||"",y=o.querySelector("img")?.src||"";L.marker([r,n],{icon:L.divIcon({className:"price-marker",html:i,iconSize:null,iconAnchor:[30,20]})}).addTo(d).bindPopup(`
      <div style="text-align:center;width:230px">
        ${y?`<img src="${y}" alt="${c}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">`:""}
        <strong style="font-size:16px">${c}</strong><br>
        ${g?`<small>${g}</small><br>`:""}
        <span style="font-weight:bold;color:#2f6f3f;font-size:16px">${i}</span>
      </div>
    `),e.push([r,n])}),e.length>0?a.fitBounds(e,{padding:[50,50]}):a.setView([46.5,2],6)}function M(t){const e=s("#pagination");if(!e)return;e.innerHTML="";const o=Math.max(1,Math.ceil(t/f));for(let r=1;r<=o;r++){const n=document.createElement("button");n.textContent=r,r===p&&n.classList.add("active"),n.addEventListener("click",()=>{p=r,m()}),e.appendChild(n)}}function m(){const t=(p-1)*f,e=t+f;l.forEach((o,r)=>{o.style.display=r>=t&&r<e?"":"none"}),M(l.length),w()}function h(){const t=(s("#dest-desktop")?.value||"").trim().toLowerCase();l=t?u.filter(e=>{const o=(e.dataset.ville||"").toLowerCase(),r=(e.querySelector("h3")?.textContent||"").toLowerCase();return o.includes(t)||r.includes(t)}):[...u],p=1,m()}document.addEventListener("DOMContentLoaded",()=>{typeof updateCartCount=="function"&&updateCartCount();const t=s("#cardsContainer");u=t?v(".card",t):[],l=[...u],t&&(s("#search-btn")?.addEventListener("click",h),s("#dest-desktop")?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),h())}),x(),m())});document.addEventListener("DOMContentLoaded",()=>{const t=s("#toggleAmenities"),e=s("#moreAmenities");!t||!e||t.addEventListener("click",()=>{e.classList.toggle("hidden__detail"),t.textContent=e.classList.contains("hidden__detail")?"Voir plus":"Voir moins"})});function O(){const t=s("#map");if(!t||typeof L>"u")return;const e=L.map(t).setView([45.75,4.85],10);L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap | CARTO",subdomains:"abcd",maxZoom:20}).addTo(e),L.marker([45.75,4.85]).addTo(e).bindPopup("<strong>Cabane perchée en forêt</strong><br>Lyon")}window.initMapDetail=O;
