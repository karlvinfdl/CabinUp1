(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();window.$=(n,t=document)=>t.querySelector(n);window.$$=(n,t=document)=>Array.from(t.querySelectorAll(n));const h=$("#nav-toggle"),y=$("#menu-close"),u=$("#mobile-menu");document.addEventListener("DOMContentLoaded",()=>{h&&y&&u?(h.addEventListener("click",()=>u.style.display="flex"),y.addEventListener("click",()=>u.style.display="none")):console.warn("‚ö†Ô∏è Les √©l√©ments du menu burger sont manquants.")});document.addEventListener("DOMContentLoaded",()=>{const n=$("#search-btn"),t=$("#mobile-popup"),e=$("#popup-close"),r=$("#popup-clear");n&&t&&e&&(n.addEventListener("click",o=>{window.innerWidth<=768&&(o.preventDefault(),t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.classList.add("popup-open"))}),e.addEventListener("click",()=>{t.classList.remove("active"),t.setAttribute("aria-hidden","true"),document.body.classList.remove("popup-open")}),r?.addEventListener("click",()=>{t.querySelectorAll("input").forEach(o=>o.value=""),t.querySelectorAll(".accueil__num").forEach(o=>o.textContent="0")}))});document.addEventListener("DOMContentLoaded",()=>{const n=$(".features-toggle"),t=$$(".feature__accueil2.feature-hidden");n&&n.addEventListener("click",()=>{const e=n.classList.toggle("open"),r=n.querySelector("i");r.classList.toggle("fa-chevron-down",!e),r.classList.toggle("fa-chevron-up",e),n.setAttribute("aria-expanded",e?"true":"false"),t.forEach(o=>o.style.display=e?"flex":"none")})});const m=6;let d=[],c=[],p=1,a,l;function b(){if(!(!$("#map")||typeof L>"u")){if(a){console.warn("Carte du catalogue d√©j√† initialis√©e");return}a=L.map("map",{zoomControl:!0}).setView([46.5,2],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | <a href="https://carto.com/">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(a),l=L.layerGroup().addTo(a),setTimeout(()=>a.invalidateSize(),300)}}function E(){if(!a||!l)return;l.clearLayers();const n=c.filter(e=>e.style.display!=="none"),t=[];n.forEach(e=>{const r=parseFloat(e.dataset.lat),o=parseFloat(e.dataset.lng);if(isNaN(r)||isNaN(o))return;const i=e.dataset.prix||"",s=e.dataset.ville||"",g=e.querySelector("img")?.src||"";L.marker([r,o],{icon:L.divIcon({className:"price-marker",html:`${i}‚Ç¨`,iconSize:null,iconAnchor:[30,20]})}).addTo(l).bindPopup(`
      <div style="text-align:center;width:230px">
        ${g?`<img src="${g}" alt="${s}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">`:""}
        <strong style="font-size:16px">${s}</strong><br>
        <span style="font-weight:bold;color:#2f6f3f;font-size:16px">${i} ‚Ç¨ / nuit</span>
      </div>
    `),t.push([r,o])}),t.length>0?a.fitBounds(t,{padding:[50,50]}):a.setView([46.5,2],6)}function w(n){const t=$("#pagination");if(!t)return;t.innerHTML="";const e=Math.max(1,Math.ceil(n/m));for(let r=1;r<=e;r++){const o=document.createElement("button");o.textContent=r,r===p&&o.classList.add("active"),o.addEventListener("click",()=>{p=r,f()}),t.appendChild(o)}}function f(){const n=(p-1)*m,t=n+m;c.forEach((e,r)=>{e.style.display=r>=n&&r<t?"":"none"}),w(c.length),E()}function v(){const n=($("#dest-desktop")?.value||"").trim().toLowerCase();c=n?d.filter(t=>{const e=(t.dataset.ville||"").toLowerCase(),r=(t.querySelector("h3")?.textContent||"").toLowerCase();return e.includes(n)||r.includes(n)}):[...d],p=1,f()}document.addEventListener("DOMContentLoaded",()=>{const n=$("#cardsContainer");n&&fetch("http://localhost:3001/logements").then(t=>{if(!t.ok)throw new Error("Erreur serveur");return t.json()}).then(t=>{n.innerHTML=t.map(e=>`
        <a href="../pages/detail.html?id=${e.id}" class="card"
           data-lat="${e.lat}" data-lng="${e.lng}"
           data-ville="${e.ville}" data-prix="${e.prix}">
          <img src="${e.image||"../assets/images/placeholder.jpg"}" alt="${e.titre}">
          <div class="card-body">
            <div class="card-content">
              <h3>${e.titre}</h3>
              <p>${e.ville} ‚Ä¢ ${e.capacite||1} personne${(e.capacite||1)>1?"s":""}</p>
              <span class="available">
                ${typeof e.disponibilite=="number"?`${e.disponibilite} logement(s) dispo`:e.disponibilite||""}
              </span>
            </div>
            <p class="price">${e.prix} ‚Ç¨/nuit</p>
          </div>
        </a>
      `).join(""),d=$$(".card",n),c=[...d],$("#search-btn")?.addEventListener("click",v),$("#dest-desktop")?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),v())}),b(),f()}).catch(t=>{console.error("‚ùå Erreur lors du chargement du JSON :",t),n.innerHTML="<p style='color:red;'>Impossible de charger les logements üò¢</p>"})});function C(){const n=$("#map");if(!n||typeof L>"u")return;const t=L.map(n).setView([45.75,4.85],10);L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap | CARTO",subdomains:"abcd",maxZoom:20}).addTo(t),L.marker([45.75,4.85]).addTo(t).bindPopup("<strong>Cabane perch√©e en for√™t</strong><br>Lyon")}window.initMapDetail=C;
