(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const d=(r,n=document)=>n.querySelector(r),I=(r,n=document)=>Array.from(n.querySelectorAll(r)),T=d("#nav-toggle"),A=d("#menu-close"),w=d("#mobile-menu");document.addEventListener("DOMContentLoaded",()=>{T&&A&&w?(T.addEventListener("click",()=>w.style.display="flex"),A.addEventListener("click",()=>w.style.display="none")):console.warn("‚ö†Ô∏è Les √©l√©ments du menu burger sont manquants.")});document.addEventListener("DOMContentLoaded",()=>{const r=d("#search-btn"),n=d("#mobile-popup"),t=d("#popup-close"),a=d("#popup-clear");r&&n&&t&&(r.addEventListener("click",s=>{window.innerWidth<=768&&(s.preventDefault(),n.classList.add("active"),n.setAttribute("aria-hidden","false"),document.body.classList.add("popup-open"))}),t.addEventListener("click",()=>{n.classList.remove("active"),n.setAttribute("aria-hidden","true"),document.body.classList.remove("popup-open")}),a?.addEventListener("click",()=>{n.querySelectorAll("input").forEach(s=>s.value=""),n.querySelectorAll(".accueil__num").forEach(s=>s.textContent="0")}))});document.addEventListener("DOMContentLoaded",()=>{const r=d(".features-toggle"),n=I(".feature__accueil2.feature-hidden");r&&r.addEventListener("click",()=>{const t=r.classList.toggle("open"),a=r.querySelector("i");a.classList.toggle("fa-chevron-down",!t),a.classList.toggle("fa-chevron-up",t),r.setAttribute("aria-expanded",t?"true":"false"),n.forEach(s=>s.style.display=t?"flex":"none")})});const N=6;let b=[],v=[],S=1,p,h;function V(){const r=d("#map");if(p){console.warn("La carte du catalogue a d√©j√† √©t√© initialis√©e.");return}!r||typeof L>"u"||(p=L.map("map",{zoomControl:!0}).setView([46.5,2],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | <a href="https://carto.com/">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(p),h=L.layerGroup().addTo(p),setTimeout(()=>p.invalidateSize(),300))}function Z(){if(!p||!h)return;h.clearLayers();const r=v.filter(t=>t.style.display!=="none"),n=[];r.forEach(t=>{const a=parseFloat(t.dataset.lat),s=parseFloat(t.dataset.lng);if(isNaN(a)||isNaN(s))return;const o=t.dataset.prix||"",u=t.dataset.ville||"",y=t.querySelector("img")?.src||"";L.marker([a,s],{icon:L.divIcon({className:"price-marker",html:`${o}‚Ç¨`,iconSize:null,iconAnchor:[30,20]})}).addTo(h).bindPopup(`
      <div style="text-align:center;width:230px">
        ${y?`<img src="${y}" alt="${u}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">`:""}
        <strong style="font-size:16px">${u}</strong><br>
        <span style="font-weight:bold;color:#2f6f3f;font-size:16px">${o} ‚Ç¨ / nuit</span>
      </div>
    `),n.push([a,s])}),n.length>0?p.fitBounds(n,{padding:[50,50]}):p.setView([46.5,2],6)}function R(r){const n=d("#pagination");if(!n)return;n.innerHTML="";const t=Math.max(1,Math.ceil(r/N));for(let a=1;a<=t;a++){const s=document.createElement("button");s.textContent=a,a===S&&s.classList.add("active"),s.addEventListener("click",()=>{S=a,M()}),n.appendChild(s)}}function M(){const r=(S-1)*N,n=r+N;v.forEach((t,a)=>{t.style.display=a>=r&&a<n?"":"none"}),R(v.length),Z()}function D(){const r=(d("#dest-desktop")?.value||"").trim().toLowerCase();v=r?b.filter(n=>{const t=(n.dataset.ville||"").toLowerCase(),a=(n.querySelector("h3")?.textContent||"").toLowerCase();return t.includes(r)||a.includes(r)}):[...b],S=1,M()}document.addEventListener("DOMContentLoaded",()=>{const r=d("#cardsContainer");r&&fetch("http://127.0.0.1:3001/logements").then(n=>{if(!n.ok)throw new Error("Erreur serveur");return n.json()}).then(n=>{r.innerHTML=n.map(t=>`
        <a href="../pages/detail.html?id=${t.id}" class="card"
           data-lat="${t.lat}" data-lng="${t.lng}"
           data-ville="${t.ville}" data-prix="${t.prix}">
          <img src="${t.image||"../assets/images/placeholder.jpg"}" alt="${t.titre}">
          <div class="card-body">
            <div class="card-content">
              <h3>${t.titre}</h3>
              <p>${t.ville} ‚Ä¢ ${t.capacite||1} personne${(t.capacite||1)>1?"s":""}</p>
              <span class="available">
                ${typeof t.disponibilite=="number"?`${t.disponibilite} logement(s) dispo`:t.disponibilite||""}
              </span>
            </div>
            <p class="price">${t.prix} ‚Ç¨/nuit</p>
          </div>
        </a>
      `).join(""),b=I(".card",r),v=[...b],d("#search-btn")?.addEventListener("click",D),d("#dest-desktop")?.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),D())}),V(),M()}).catch(n=>{console.error("‚ùå Erreur lors du chargement du JSON :",n),r.innerHTML="<p style='color:red;'>Impossible de charger les logements üò¢</p>"})});function K(){const r=d("#map");if(!r||typeof L>"u")return;const n=L.map(r).setView([45.75,4.85],10);L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap | CARTO",subdomains:"abcd",maxZoom:20}).addTo(n),L.marker([45.75,4.85]).addTo(n).bindPopup("<strong>Cabane perch√©e en for√™t</strong><br>Lyon")}window.initMapDetail=K;document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector("#cart-list");if(!r)return;const n=document.querySelector("#sum-title"),t=document.querySelector(".panier-summary .img"),a=document.querySelector("#sum-total"),s=document.querySelector("#sum-dates"),o=document.querySelector("#sum-guests"),u=e=>e?.titre??e?.title??"Sans titre",y=e=>e?.ville??e?.location??"‚Äî",x=e=>Number(e?.prix??e?.price??0),_=e=>Number(e?.capacite??e?.capacity??1),P=e=>Array.isArray(e?.images)&&e.images.length>0?e.images[0]:e?.image?e.image:"../assets/images/placeholder.jpg",B=(e,c)=>e.id!=null?String(e.id):(u(e)+"|"+x(e)+"|"+c).toLowerCase().replace(/\s+/g,"-");let i=JSON.parse(localStorage.getItem("cart")||"[]").map((e,c)=>({id:B(e,c),titre:u(e),prix:x(e),image:P(e),ville:y(e),capacite:_(e),nights:Number(e?.nights??1),arrivee:e?.arrivee??"",depart:e?.depart??"",guests:Number(e?.guests??1)}));localStorage.setItem("cart",JSON.stringify(i));const O=()=>{r.innerHTML='<p style="text-align:center;">Votre panier est vide üõí</p>',n.textContent="Aucun logement s√©lectionn√©",t.innerHTML="",a.textContent="0 ‚Ç¨",s.textContent="‚Äî",o.textContent="‚Äî"};if(i.length===0)return O();const k=()=>{r.innerHTML=i.map((e,c)=>`
      <article class="panier-card" data-idx="${c}">
        <div class="img"><img src="${e.image}" alt="${e.titre}"></div>
        <div class="panier-card__body">
          <h3>${e.titre}</h3>
          <div class="features">
            <span><i class="fa-solid fa-location-dot"></i> ${e.ville}</span>
            <span><i class="fa-solid fa-user-group"></i> ${e.capacite} pers.</span>
          </div>
          <div class="panier-card__footer">
            <p><strong>${e.prix} ‚Ç¨</strong> / nuit</p>
            <button class="panier-card__remove" data-idx="${c}" title="Supprimer du panier">
              <i class="fa-solid fa-trash"></i>
            </button>
          </div>
        </div>
      </article>
    `).join("")},f=e=>{e&&(n.textContent=e.titre,a.textContent=`${e.prix} ‚Ç¨ / nuit`,t.innerHTML=e.image?`<img src="${e.image}" alt="${e.titre}">`:"",s.textContent=e.arrivee&&e.depart?`${e.arrivee} ‚Üí ${e.depart} (${e.nights} nuit${e.nights>1?"s":""})`:"Non renseign√©es",o.textContent=`${e.guests||1} voyageur${(e.guests||1)>1?"s":""}`)},E=e=>{document.querySelectorAll(".panier-card").forEach(m=>{m.classList.remove("active"),m.style.outline="none"});const c=document.querySelector(`.panier-card[data-idx="${e}"]`);c&&(c.classList.add("active"),c.style.outline="3px solid #2E5E4E")};k();let l=0;f(i[l]),E(l),r.addEventListener("click",e=>{const c=e.target.closest(".panier-card__remove"),m=e.target.closest(".panier-card");if(c){e.stopPropagation();const g=Number(c.dataset.idx),q=c.closest(".panier-card");q.style.transition="opacity .25s ease, transform .25s ease",q.style.opacity="0",q.style.transform="translateX(-20px)",setTimeout(()=>{if(i.splice(g,1),localStorage.setItem("cart",JSON.stringify(i)),i.length===0)return O();k(),l===g?l=0:l>g&&(l-=1),f(i[l]),E(l)},250);return}if(m){const g=Number(m.dataset.idx);l=g,f(i[g]),E(g)}});const $=document.querySelector("#modal-edit-dates"),j=document.querySelector("#edit-dates-btn"),z=document.querySelector("#cancel-dates"),G=document.querySelector("#save-dates");j?.addEventListener("click",()=>$.classList.add("active")),z?.addEventListener("click",()=>$.classList.remove("active")),G?.addEventListener("click",()=>{const e=document.querySelector("#input-arrivee").value,c=document.querySelector("#input-depart").value,m=Number(document.querySelector("#input-nights").value||1);i[l].arrivee=e,i[l].depart=c,i[l].nights=m,localStorage.setItem("cart",JSON.stringify(i)),f(i[l]),$.classList.remove("active")});const C=document.querySelector("#modal-edit-guests"),H=document.querySelector("#edit-guests-btn"),F=document.querySelector("#cancel-guests"),J=document.querySelector("#save-guests");H?.addEventListener("click",()=>C.classList.add("active")),F?.addEventListener("click",()=>C.classList.remove("active")),J?.addEventListener("click",()=>{const e=Number(document.querySelector("#input-guests").value||1);i[l].guests=e,localStorage.setItem("cart",JSON.stringify(i)),f(i[l]),C.classList.remove("active")})});
