(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();window.$=(o,t=document)=>t.querySelector(o);window.$$=(o,t=document)=>Array.from(t.querySelectorAll(o));const h=$("#nav-toggle"),y=$("#menu-close"),u=$("#mobile-menu");document.addEventListener("DOMContentLoaded",()=>{h&&y&&u?(h.addEventListener("click",()=>u.style.display="flex"),y.addEventListener("click",()=>u.style.display="none")):console.warn("‚ö†Ô∏è Les √©l√©ments du menu burger sont manquants.")});document.addEventListener("DOMContentLoaded",()=>{const o=$("#search-btn"),t=$("#mobile-popup"),e=$("#popup-close"),r=$("#popup-clear");o&&t&&e&&(o.addEventListener("click",n=>{window.innerWidth<=768&&(n.preventDefault(),t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.classList.add("popup-open"))}),e.addEventListener("click",()=>{t.classList.remove("active"),t.setAttribute("aria-hidden","true"),document.body.classList.remove("popup-open")}),r?.addEventListener("click",()=>{t.querySelectorAll("input").forEach(n=>n.value=""),t.querySelectorAll(".accueil__num").forEach(n=>n.textContent="0")}))});document.addEventListener("DOMContentLoaded",()=>{const o=$(".features-toggle"),t=$$(".feature__accueil2.feature-hidden");o&&o.addEventListener("click",()=>{const e=o.classList.toggle("open"),r=o.querySelector("i");r.classList.toggle("fa-chevron-down",!e),r.classList.toggle("fa-chevron-up",e),o.setAttribute("aria-expanded",e?"true":"false"),t.forEach(n=>n.style.display=e?"flex":"none")})});const m=6;let d=[],c=[],p=1,i,l;function b(){if(!(!$("#map")||typeof L>"u")){if(i){console.warn("Carte du catalogue d√©j√† initialis√©e");return}i=L.map("map",{zoomControl:!0}).setView([46.5,2],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> | <a href="https://carto.com/">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(i),l=L.layerGroup().addTo(i),setTimeout(()=>i.invalidateSize(),300)}}function w(){if(!i||!l)return;l.clearLayers();const o=c.filter(e=>e.style.display!=="none"),t=[];o.forEach(e=>{const r=parseFloat(e.dataset.lat),n=parseFloat(e.dataset.lng);if(isNaN(r)||isNaN(n))return;const a=e.dataset.prix||"",s=e.dataset.ville||"",g=e.querySelector("img")?.src||"";L.marker([r,n],{icon:L.divIcon({className:"price-marker",html:`${a}‚Ç¨`,iconSize:null,iconAnchor:[30,20]})}).addTo(l).bindPopup(`
      <div style="text-align:center;width:230px">
        ${g?`<img src="${g}" alt="${s}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">`:""}
        <strong style="font-size:16px">${s}</strong><br>
        <span style="font-weight:bold;color:#2f6f3f;font-size:16px">${a} ‚Ç¨ / nuit</span>
      </div>
    `),t.push([r,n])}),t.length>0?i.fitBounds(t,{padding:[50,50]}):i.setView([46.5,2],6)}function E(o){const t=$("#pagination");if(!t)return;t.innerHTML="";const e=Math.max(1,Math.ceil(o/m));for(let r=1;r<=e;r++){const n=document.createElement("button");n.textContent=r,r===p&&n.classList.add("active"),n.addEventListener("click",()=>{p=r,f()}),t.appendChild(n)}}function f(){const o=(p-1)*m,t=o+m;c.forEach((e,r)=>{e.style.display=r>=o&&r<t?"":"none"}),E(c.length),w()}function v(){const o=($("#dest-desktop")?.value||"").trim().toLowerCase();c=o?d.filter(t=>{const e=(t.dataset.ville||"").toLowerCase(),r=(t.querySelector("h3")?.textContent||"").toLowerCase();return e.includes(o)||r.includes(o)}):[...d],p=1,f()}document.addEventListener("DOMContentLoaded",()=>{const o=window.location.hostname==="localhost"?"http://localhost:3001/logements":"/db.json";fetch(o).then(t=>{if(!t.ok)throw new Error("Erreur serveur");return t.json()}).then(t=>{container.innerHTML=t.map(e=>`
        <a href="../pages/detail.html?id=${e.id}" class="card"
           data-lat="${e.lat}" data-lng="${e.lng}"
           data-ville="${e.ville}" data-prix="${e.prix}">
          <img src="${e.image||"../assets/images/placeholder.jpg"}" alt="${e.titre}">
          <div class="card-body">
            <div class="card-content">
              <h3>${e.titre}</h3>
              <p>${e.ville} ‚Ä¢ ${e.capacite||1} personne${(e.capacite||1)>1?"s":""}</p>
              <span class="available">
                ${typeof e.disponibilite=="number"?`${e.disponibilite} logement(s) dispo`:e.disponibilite||""}
              </span>
            </div>
            <p class="price">${e.prix} ‚Ç¨/nuit</p>
          </div>
        </a>
      `).join(""),d=$$(".card",container),c=[...d],$("#search-btn")?.addEventListener("click",v),$("#dest-desktop")?.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),v())}),b(),f()}).catch(t=>{console.error("‚ùå Erreur lors du chargement du JSON :",t),container.innerHTML="<p style='color:red;'>Impossible de charger les logements üò¢</p>"})});function C(){const o=$("#map");if(!o||typeof L>"u")return;const t=L.map(o).setView([45.75,4.85],10);L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap | CARTO",subdomains:"abcd",maxZoom:20}).addTo(t),L.marker([45.75,4.85]).addTo(t).bindPopup("<strong>Cabane perch√©e en for√™t</strong><br>Lyon")}window.initMapDetail=C;
