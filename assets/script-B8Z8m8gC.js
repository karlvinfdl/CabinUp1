(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const s=(e,t=document)=>t.querySelector(e),q=(e,t=document)=>Array.from(t.querySelectorAll(e)),O=document.getElementById("nav-toggle"),_=document.getElementById("menu-close"),w=document.getElementById("mobile-menu");O?.addEventListener("click",()=>w.style.display="flex");_?.addEventListener("click",()=>w.style.display="none");document.addEventListener("DOMContentLoaded",()=>{const e=s("#search-btn"),t=s("#mobile-popup"),n=s("#popup-close"),a=s("#popup-clear");e&&t&&n&&(e.addEventListener("click",o=>{window.innerWidth<=768&&(o.preventDefault(),t.classList.add("active"),t.setAttribute("aria-hidden","false"),document.body.classList.add("popup-open"))}),n.addEventListener("click",()=>{t.classList.remove("active"),t.setAttribute("aria-hidden","true"),document.body.classList.remove("popup-open")}),a?.addEventListener("click",()=>{t.querySelectorAll("input").forEach(o=>o.value=""),t.querySelectorAll(".accueil__num").forEach(o=>o.textContent="0")}))});document.addEventListener("DOMContentLoaded",()=>{const e=s(".features-toggle"),t=q(".feature__accueil2.feature-hidden");e&&e.addEventListener("click",()=>{const n=e.classList.toggle("open"),a=e.querySelector("i");a.classList.toggle("fa-chevron-down",!n),a.classList.toggle("fa-chevron-up",n),e.setAttribute("aria-expanded",n?"true":"false"),t.forEach(o=>o.style.display=n?"flex":"none")})});const E=6;let v=[],m=[],h=1,d,y;function $(){!s("#map")||typeof L>"u"||(d=L.map("map",{zoomControl:!0}).setView([46.5,2],6),L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(d),y=L.layerGroup().addTo(d),setTimeout(()=>d.invalidateSize(),300),console.log("âœ… Carte du catalogue initialisÃ©e !"))}function A(){if(!d||!y)return;y.clearLayers();const e=m.filter(n=>n.style.display!=="none"),t=[];e.forEach(n=>{const a=parseFloat(n.dataset.lat),o=parseFloat(n.dataset.lng);if(isNaN(a)||isNaN(o))return;const r=n.dataset.prix||"",i=n.dataset.ville||"",c=n.querySelector("img")?.src||"";L.marker([a,o],{icon:L.divIcon({className:"price-marker",html:r,iconSize:null,iconAnchor:[30,20]})}).addTo(y).bindPopup(`
      <div style="text-align:center;width:230px">
        ${c?`<img src="${c}" alt="${i}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;margin-bottom:6px">`:""}
        <strong style="font-size:16px">${i}</strong><br>
        <span style="font-weight:bold;color:#2f6f3f;font-size:16px">${r}</span>
      </div>
    `),t.push([a,o])}),t.length>0?d.fitBounds(t,{padding:[50,50]}):d.setView([46.5,2],6)}function B(e){const t=s("#pagination");if(!t)return;t.innerHTML="";const n=Math.max(1,Math.ceil(e/E));for(let a=1;a<=n;a++){const o=document.createElement("button");o.textContent=a,a===h&&o.classList.add("active"),o.addEventListener("click",()=>{h=a,b()}),t.appendChild(o)}}function b(){const e=(h-1)*E,t=e+E;m.forEach((n,a)=>{n.style.display=a>=e&&a<t?"":"none"}),B(m.length),A()}function C(){const e=(s("#dest-desktop")?.value||"").trim().toLowerCase();m=e?v.filter(t=>{const n=(t.dataset.ville||"").toLowerCase(),a=(t.querySelector("h3")?.textContent||"").toLowerCase();return n.includes(e)||a.includes(e)}):[...v],h=1,b()}document.addEventListener("DOMContentLoaded",()=>{const e=s("#cardsContainer");v=e?q(".card",e):[],m=[...v],e&&(s("#search-btn")?.addEventListener("click",C),s("#dest-desktop")?.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),C())}),$(),b())});function N(){const e=s("#map");if(!e||typeof L>"u")return;const t=L.map(e).setView([45.75,4.85],10);L.tileLayer("https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",{attribution:"&copy; OpenStreetMap | CARTO",subdomains:"abcd",maxZoom:20}).addTo(t),L.marker([45.75,4.85]).addTo(t).bindPopup("<strong>Cabane perchÃ©e en forÃªt</strong><br>Lyon")}window.initMapDetail=N;document.addEventListener("DOMContentLoaded",()=>{const e=s("#toggleAmenities"),t=s("#moreAmenities");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden__detail"),e.textContent=t.classList.contains("hidden__detail")?"Voir plus":"Voir moins"})});function T(e){let t=JSON.parse(localStorage.getItem("cart"))||[];if(t.find(a=>a.title===e.title)){alert("Ce logement est dÃ©jÃ  dans votre panier !");return}t.push(e),localStorage.setItem("cart",JSON.stringify(t)),alert("âœ… Logement ajoutÃ© au panier !")}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("add-to-cart");e&&e.addEventListener("click",t=>{t.preventDefault();const n=s("#product-title")?.textContent.trim(),a=s("#product-price")?.dataset.value||"0",o=s("#product-image")?.src,r=s(".meta__detail span")?.textContent||"Inconnu",i={title:n,price:parseFloat(a),image:o,location:r,nights:1,arrivee:"",depart:"",guests:1};T(i),window.location.href="../pages/panier.html"})});let p=null;function S(){const e=document.querySelector("#cart-list"),t=document.querySelector(".panier-summary .img"),n=document.querySelector("#sum-title"),a=document.querySelector("#sum-dates"),o=document.querySelector("#sum-guests"),r=document.querySelector("#sum-total"),i=JSON.parse(localStorage.getItem("cart"))||[];if(e){if(i.length===0){e.innerHTML="<p>Votre panier est vide ðŸ˜¢</p>",t.innerHTML="",n.textContent="â€”",a.textContent="â€”",o.textContent="â€”",r.textContent="0 â‚¬";return}e.innerHTML=i.map((c,l)=>`
    <article class="panier-card" data-index="${l}">
      <div class="img"><img src="${c.image}" alt="${c.title}"></div>
      <div class="panier-card__body">
        <h3>${c.title}</h3>
        <div class="features">
          <span><i class="fa-solid fa-bed"></i> 1 chambre</span>
          <span><i class="fa-solid fa-bath"></i> 1 bain</span>
          <span><i class="fa-solid fa-wifi"></i> WiFi</span>
        </div>
        <div class="panier-card__footer">
          <span>${c.price} â‚¬/nuit</span>
          <button class="panier-card__remove" data-index="${l}">
            <i class="fa-solid fa-trash"></i>
          </button>
        </div>
      </div>
    </article>
  `).join(""),document.querySelectorAll(".panier-card").forEach(c=>{c.addEventListener("click",()=>{const l=c.dataset.index;x(i[l])})}),document.querySelectorAll(".panier-card__remove").forEach(c=>{c.addEventListener("click",l=>{l.stopPropagation(),D(c.dataset.index)})}),x(i[0])}}function x(e){p=e;const t=document.querySelector(".panier-summary .img"),n=document.querySelector("#sum-title"),a=document.querySelector("#sum-dates"),o=document.querySelector("#sum-guests"),r=document.querySelector("#sum-total");t.innerHTML=`<img src="${e.image}" alt="${e.title}" style="width:100%;height:100%;object-fit:cover;border-radius:20px;">`,n.textContent=e.title,a.textContent=e.arrivee&&e.depart?`${e.arrivee} â†’ ${e.depart}`:"â€”",o.textContent=`${e.guests||1} adulte${e.guests>1?"s":""}`,r.textContent=`${(e.price*(e.nights||1)).toFixed(2)} â‚¬`;const i=document.querySelector(".panier-summary__body");i.querySelectorAll(".summary-row button").forEach(M=>M.remove());const c=i.querySelector("#sum-dates").parentElement,l=i.querySelector("#sum-guests").parentElement,f=document.createElement("button");f.textContent="Modifier",f.className="btn--grey",f.onclick=()=>I("dates");const g=document.createElement("button");g.textContent="Modifier",g.className="btn--grey",g.onclick=()=>I("guests"),c.appendChild(f),l.appendChild(g)}function I(e){const t=e==="dates"?"modal-edit-dates":"modal-edit-guests",n=document.getElementById(t);n&&n.classList.add("active")}function u(e){e&&e.preventDefault(),document.querySelectorAll(".modal-overlay.active").forEach(t=>t.classList.remove("active")),document.querySelectorAll(".modal.active").forEach(t=>t.classList.remove("active"))}document.addEventListener("click",e=>{const t=e.target.closest(".modal-overlay"),n=e.target.closest(".modal-edit");t&&!n&&u()});document.addEventListener("keydown",e=>{e.key==="Escape"&&u()});document.getElementById("save-dates")?.addEventListener("click",e=>{if(e.preventDefault(),!p)return;const t=document.getElementById("input-arrivee")?.value||"",n=document.getElementById("input-depart")?.value||"",a=Number(document.getElementById("input-nights")?.value||1);k(p.title,{arrivee:t,depart:n,nights:a}),u()});document.getElementById("cancel-dates")?.addEventListener("click",u);document.getElementById("save-guests")?.addEventListener("click",e=>{if(e.preventDefault(),!p)return;const t=Number(document.getElementById("input-guests")?.value||1);k(p.title,{guests:t}),u()});document.getElementById("cancel-guests")?.addEventListener("click",u);function k(e,t){let n=JSON.parse(localStorage.getItem("cart"))||[];const a=n.findIndex(o=>o.title===e);a!==-1&&(n[a]={...n[a],...t},localStorage.setItem("cart",JSON.stringify(n)),S())}function D(e){let t=JSON.parse(localStorage.getItem("cart"))||[];t.splice(e,1),localStorage.setItem("cart",JSON.stringify(t)),S()}document.addEventListener("DOMContentLoaded",S);
