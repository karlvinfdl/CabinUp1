<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panier</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&family=Epunda+Slab:wght@400;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="../assets/style/style.css" />
  <link rel="stylesheet" href="../assets/style/panier.css" />
  <link rel="shortcut icon" href="../assets/images/logoarondie.png" />
</head>
<body>
  <header class="navbar">
    <div class="nav-brand">
      <img src="../assets/images/logo.png" alt="CabinUp logo" class="logo" />
    </div>

    <nav class="nav-links" id="nav-links">
      <a href="../index.html">Accueil</a>
      <a href="../pages/catalogue.html">Catalogue</a>
      <a href="../pages/panier.html">Panier</a>
    </nav>

    <button class="nav-toggle" id="nav-toggle" aria-label="Ouvrir le menu">â˜°</button>
  </header>

  <!-- MENU MOBILE -->
  <div class="mobile-menu" id="mobile-menu">
    <div class="menu-header">
      <img src="../assets/images/logo.png" alt="CabinUp logo" class="logo" />
      <button class="menu-close" id="menu-close" aria-label="Fermer le menu">âœ•</button>
    </div>

    <nav class="menu-links">
      <a href="../index.html">Accueil</a>
      <a href="../pages/catalogue.html">Catalogue</a>
      <a href="../pages/panier.html">Panier</a>
    </nav>

    <div class="menu-footer">
      <div class="socials">
        <div class="icons">
          <a href="#"><i class="fab fa-linkedin-in"></i></a>
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
        </div>
        <p class="follow">Suivez-nous !</p>
      </div>
      <p>Â© 2025 CabinUp</p>
    </div>
  </div>

  <!-- CONTENU PRINCIPAL -->
  <main class="panier container">
    <h1 class="panier__title">Votre panier</h1>
    <div class="panier__content">
      <section id="cart-list"></section>

      <aside class="panier-summary">
        <div class="img"></div>
        <div class="panier-summary__body">
          <h3 id="sum-title">Aucun logement sÃ©lectionnÃ©</h3>

          <div class="summary-row">
            <div><strong>Dates</strong><br><span id="sum-dates">â€”</span></div>
            <button class="btn--grey" id="edit-dates-btn">Modifier</button>
          </div>

          <div class="summary-row">
            <div><strong>Voyageurs</strong><br><span id="sum-guests">â€”</span></div>
            <button class="btn--grey" id="edit-guests-btn">Modifier</button>
          </div>

          <div class="summary-row">
            <div><strong>Prix total</strong><br><span id="sum-total">0 â‚¬</span></div>
          </div>

          <a href="#modal-paiement" class="btn btn--green">ProcÃ©der au paiement</a>
        </div>
      </aside>
    </div>
  </main>

  <!-- MODALES -->
  <div class="modal-overlay" id="modal-edit-dates">
    <div class="modal-edit">
      <h3>Modifier les dates</h3>
      <label for="input-arrivee">ArrivÃ©e :</label>
      <input type="date" id="input-arrivee" />
      <label for="input-depart">DÃ©part :</label>
      <input type="date" id="input-depart" />
      <label for="input-nights">Nombre de nuits :</label>
      <input type="number" id="input-nights" min="1" value="1" />
      <div class="modal-actions">
        <button id="cancel-dates" class="btn--grey">Annuler</button>
        <button id="save-dates" class="btn--green">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="modal-edit-guests">
    <div class="modal-edit">
      <h3>Modifier le nombre de voyageurs</h3>
      <label for="input-guests">Voyageurs :</label>
      <input type="number" id="input-guests" min="1" value="1" />
      <div class="modal-actions">
        <button id="cancel-guests" class="btn--grey">Annuler</button>
        <button id="save-guests" class="btn--green">Enregistrer</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-paiement">
    <div class="modal-content">
      <a href="#" class="close">&times;</a>
      <h2>Formulaire de paiement</h2>
      <form class="form-paiement">
        <input type="text" placeholder="PrÃ©nom" required />
        <input type="text" placeholder="Nom de famille" required />
        <input type="email" placeholder="Email" required />
        <input type="tel" placeholder="NumÃ©ro de tÃ©lÃ©phone" required />
        <h3>Objet du sÃ©jour</h3>
        <div class="radio-group">
          <label><input type="radio" name="objet" checked /> Voyage dâ€™affaires</label>
          <label><input type="radio" name="objet" /> Vacances</label>
          <label><input type="radio" name="objet" /> Autre</label>
        </div>
        <h3>Mode de paiement</h3>
        <p>Carte bancaire</p>
        <input type="text" placeholder="Nom sur la carte" required />
        <input type="text" placeholder="1234 1234 1234 1234" maxlength="19" required />
        <div class="carte-infos">
          <input type="text" placeholder="MM / YY" maxlength="5" required />
          <input type="text" placeholder="CVC" maxlength="3" required />
        </div>
        <button class="btn-payer" type="submit">Payer</button>
      </form>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-container">
      <div class="footer-left">
        <div class="logo-block">
          <img src="../assets/images/logo.png" alt="CabinUp" class="logo" />
          <div class="socials">
            <div class="icons">
              <a href="#"><i class="fab fa-instagram"></i></a>
              <a href="#"><i class="fab fa-facebook"></i></a>
              <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
            <p class="follow">Suivez-nous !</p>
          </div>
        </div>
      </div>
      <div class="footer-right">
        <div class="footer-col">
          <h4>Ã€ propos</h4>
          <a href="#">GreenGo Explore</a>
          <a href="#">Comparateur de transports</a>
        </div>
        <div class="footer-col">
          <h4>Aide & Contact</h4>
          <a href="#">Besoin dâ€™aide ?</a>
          <a href="#">HÃ©bergeurs â€“ Nous rejoindre</a>
        </div>
        <div class="footer-col">
          <h4>404</h4>
          <a href="../pages/404.html">AperÃ§u 404</a>
          <a href="#">Conditions gÃ©nÃ©rales</a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© 2025 CabinUp. Tous droits rÃ©servÃ©s.</p>
    </div>
  </footer>

  <!-- âœ… VERSION ALLÃ‰GÃ‰E DU JS PANIER -->
  <script>
    const $ = (sel) => document.querySelector(sel);

    document.addEventListener("DOMContentLoaded", () => {
      const cartList = $("#cart-list");
      if (!cartList) return;

      const sum = {
        title: $("#sum-title"),
        imgBox: $(".panier-summary .img"),
        total: $("#sum-total"),
        dates: $("#sum-dates"),
        guests: $("#sum-guests")
      };

      const cart = JSON.parse(localStorage.getItem("cart") || "[]").map((it, i) => ({
        id: it.id ?? `item-${i}`,
        titre: it.titre ?? it.title ?? "Sans titre",
        prix: Number(it.prix ?? it.price ?? 0),
        image: it.image ?? "../assets/images/placeholder.jpg",
        ville: it.ville ?? it.location ?? "â€”",
        capacite: it.capacite ?? it.capacity ?? 1,
        nights: Number(it.nights ?? 1),
        arrivee: it.arrivee ?? "",
        depart: it.depart ?? "",
        guests: Number(it.guests ?? 1)
      }));

      localStorage.setItem("cart", JSON.stringify(cart));

      const renderEmpty = () => {
        cartList.innerHTML = `<p style="text-align:center;">Votre panier est vide ðŸ›’</p>`;
        sum.title.textContent = "Aucun logement sÃ©lectionnÃ©";
        sum.imgBox.innerHTML = "";
        sum.total.textContent = "0 â‚¬";
        sum.dates.textContent = "â€”";
        sum.guests.textContent = "â€”";
      };

      if (cart.length === 0) return renderEmpty();

      const renderList = () => {
        cartList.innerHTML = cart.map((it, i) => `
  <article class="panier-card" data-idx="${i}">
    <div class="img"><img src="${it.image}" alt="${it.titre}"></div>
    <div class="panier-card__body">
      <h3>${it.titre}</h3>
      <div class="features">
        <span><i class="fas fa-location-dot"></i> ${it.ville}</span>
        <span><i class="fas fa-user-group"></i> ${it.capacite} pers.</span>
      </div>
      <div class="panier-card__footer">
        <p><strong>${it.prix} â‚¬</strong> / nuit</p>
        <button class="panier-card__remove" data-idx="${i}" title="Supprimer du panier">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  </article>
`).join("");

      };

      const updateSummary = (it) => {
        sum.title.textContent = it.titre;
        sum.total.textContent = `${it.prix} â‚¬ / nuit`;
        sum.imgBox.innerHTML = `<img src="${it.image}" alt="${it.titre}">`;
        sum.dates.textContent = it.arrivee && it.depart
          ? `${it.arrivee} â†’ ${it.depart} (${it.nights} nuit${it.nights > 1 ? "s" : ""})`
          : "Non renseignÃ©es";
        sum.guests.textContent = `${it.guests} voyageur${it.guests > 1 ? "s" : ""}`;
      };

      const highlight = (i) => {
        document.querySelectorAll(".panier-card").forEach(c => c.classList.remove("active"));
        const el = document.querySelector(`.panier-card[data-idx="${i}"]`);
        if (el) el.classList.add("active");
      };

      renderList();
      let selected = 0;
      updateSummary(cart[selected]);
      highlight(selected);

      cartList.addEventListener("click", (e) => {
        const idx = e.target.closest(".panier-card")?.dataset.idx;
        if (!idx) return;
        const btn = e.target.closest(".panier-card__remove");
        if (btn) {
          cart.splice(idx, 1);
          localStorage.setItem("cart", JSON.stringify(cart));
          return cart.length ? (renderList(), updateSummary(cart[0]), highlight(0)) : renderEmpty();
        }
        selected = Number(idx);
        updateSummary(cart[selected]);
        highlight(selected);
      });

      const mDates = $("#modal-edit-dates");
      $("#edit-dates-btn")?.addEventListener("click", () => mDates.classList.add("active"));
      $("#cancel-dates")?.addEventListener("click", () => mDates.classList.remove("active"));
      $("#save-dates")?.addEventListener("click", () => {
        Object.assign(cart[selected], {
          arrivee: $("#input-arrivee").value,
          depart: $("#input-depart").value,
          nights: Number($("#input-nights").value || 1)
        });
        localStorage.setItem("cart", JSON.stringify(cart));
        updateSummary(cart[selected]);
        mDates.classList.remove("active");
      });

      const mGuests = $("#modal-edit-guests");
      $("#edit-guests-btn")?.addEventListener("click", () => mGuests.classList.add("active"));
      $("#cancel-guests")?.addEventListener("click", () => mGuests.classList.remove("active"));
      $("#save-guests")?.addEventListener("click", () => {
        cart[selected].guests = Number($("#input-guests").value || 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        updateSummary(cart[selected]);
        mGuests.classList.remove("active");
      });
    });
  </script>

  <script src="https://kit.fontawesome.com/a2e0ad4f0b.js" crossorigin="anonymous"></script>
  <script type="module" src="../assets/script/script.js"></script>
</body>
</html>
